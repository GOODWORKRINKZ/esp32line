#ifndef CONFIG_H
#define CONFIG_H

// ═══════════════════════════════════════════════════════════════════════════
// НАСТРОЙКИ РЕЖИМА РАБОТЫ
// ═══════════════════════════════════════════════════════════════════════════

// Раскомментируйте для использования энкодеров FC-03
#define USE_ENCODERS

// Режим отладки - выводит подробную информацию в Serial
#define DEBUG_MODE

// ═══════════════════════════════════════════════════════════════════════════
// ПИНЫ ПОДКЛЮЧЕНИЯ
// ═══════════════════════════════════════════════════════════════════════════

// Датчики линии TCRT5000 (цифровые входы)
#define SENSOR_1  32  // Крайний левый
#define SENSOR_2  35  // Левый
#define SENSOR_3  25  // Центральный
#define SENSOR_4  26  // Правый
#define SENSOR_5  27  // Крайний правый

// Управление моторами L298N (без PWM на ENA/ENB, управление через INx)
#define MOTOR_LEFT_FWD   12  // IN1 - левый мотор вперед
#define MOTOR_LEFT_BWD   13  // IN2 - левый мотор назад
#define MOTOR_RIGHT_FWD  14  // IN3 - правый мотор вперед
#define MOTOR_RIGHT_BWD  15  // IN4 - правый мотор назад

// Настройки ПВМ для моторов
#define PWM_FREQ         30000  // Частота ПВМ 30 кГц (выше слышимого диапазона)
#define PWM_RESOLUTION   8      // Разрешение 8 бит (0-255)
#define PWM_CHANNEL_L_FWD  0    // Канал ПВМ для левого мотора вперед
#define PWM_CHANNEL_L_BWD  1    // Канал ПВМ для левого мотора назад
#define PWM_CHANNEL_R_FWD  2    // Канал ПВМ для правого мотора вперед
#define PWM_CHANNEL_R_BWD  3    // Канал ПВМ для правого мотора назад

// Энкодеры FC-03 (опционально, прерывания)
#define ENCODER_LEFT   16  // Левый энкодер
#define ENCODER_RIGHT  17  // Правый энкодер

// Кнопка старт/стоп
#define BUTTON_PIN     4   // Пин кнопки запуска/остановки (подключен к GND)

// ═══════════════════════════════════════════════════════════════════════════
// ПАРАМЕТРЫ РОБОТА
// ═══════════════════════════════════════════════════════════════════════════

// Физические параметры
#define WHEEL_DIAMETER      65.0    // Диаметр колеса в мм
#define WHEEL_BASE          125.0   // Расстояние между колесами в мм
#define ENCODER_SLOTS       12      // Количество прорезей в диске энкодера

// Вычисляемые константы
#define WHEEL_CIRCUMFERENCE (PI * WHEEL_DIAMETER)
#define MM_PER_TICK         (WHEEL_CIRCUMFERENCE / ENCODER_SLOTS)

// ═══════════════════════════════════════════════════════════════════════════
// КИНЕМАТИЧЕСКАЯ МОДЕЛЬ
// ═══════════════════════════════════════════════════════════════════════════
// Для поворота на месте каждое колесо проходит дугу = (угол/360) × π × база
// Тики на градус поворота = (π × база / 360) / MM_PER_TICK
#define TICKS_PER_DEGREE    ((PI * WHEEL_BASE / 360.0) / MM_PER_TICK)
// При базе 125мм, диаметре 65мм и 12 прорезях:
// MM_PER_TICK = π × 65 / 12 ≈ 17.02 мм/тик
// TICKS_PER_DEGREE ≈ 0.064 тика на градус
// Для поворота на 90°: 90 × 0.064 ≈ 5.8 тиков на каждом колесе

// Параметры оценки угла поворота по ошибке датчиков
// Формула: угол = (ошибка - MIN_TURN_ERROR) * DEGREES_PER_ERROR + BASE_TURN_ANGLE
#define MIN_TURN_ERROR       1.0   // Минимальная ошибка для расчёта угла
#define DEGREES_PER_ERROR    30.0  // Градусов на единицу ошибки
#define BASE_TURN_ANGLE      15.0  // Базовый угол поворота (градусы)

// ═══════════════════════════════════════════════════════════════════════════
// ПАРАМЕТРЫ СКОРОСТИ
// ═══════════════════════════════════════════════════════════════════════════

#define BASE_SPEED     130  // Базовая скорость (0-255)
#define MAX_SPEED      200  // Максимальная скорость
#define MIN_SPEED      80   // Минимальная скорость (выше мёртвой зоны моторов!)
#define TURN_SPEED     130  // Скорость при повороте на месте (должна быть выше мёртвой зоны!)

// ═══════════════════════════════════════════════════════════════════════════
// ПАРАМЕТРЫ ПИД
// ═══════════════════════════════════════════════════════════════════════════

#define DEFAULT_KP     25.0  // Пропорциональный коэффициент
#define DEFAULT_KI     0.0   // Интегральный коэффициент
#define DEFAULT_KD     15.0  // Дифференциальный коэффициент

// Параметры ПИД для скорости (с энкодерами)
#define SPEED_KP       2.0
#define SPEED_KI       0.5
#define SPEED_KD       0.1

// ═══════════════════════════════════════════════════════════════════════════
// ПРОЧИЕ ПАРАМЕТРЫ
// ═══════════════════════════════════════════════════════════════════════════

#define SEARCH_TIMEOUT     2000  // Таймаут поиска линии (мс)
#define LINE_MEMORY_TIMEOUT  150  // Время памяти последней позиции линии (мс)
#define BUTTON_DEBOUNCE_MS 150    // Время антидребезга кнопки (мс)

#endif // CONFIG_H
